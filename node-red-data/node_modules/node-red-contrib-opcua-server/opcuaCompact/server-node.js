"use strict";module.exports=function(a){require("source-map-support").install(),a.httpAdmin.get("/OPCUA/compact/xmlsets/public",a.auth.needsPermission("opcuaCompact.xmlsets"),function(e,t){var o=[],i=require("./core/chore");o.push(i.de.bianco.royal.compact.opcua.nodesets.di),o.push(i.de.bianco.royal.compact.opcua.nodesets.adi),t.json(o)}),a.nodes.registerType("opcua-compact-server",function(o){var t,i=require("./core/server"),n=require("./core/server-sandbox"),r=(a.nodes.createNode(this,o),this.name=o.name,this.port=o.port,this),e=(i.detailLog("create node "+r.id),i.choreCompact.listenForErrors(r),i.choreCompact.setStatusInit(r),i.readConfigOfServerNode(r,o),setTimeout(function(){i.detailLog("pending node "+r.id),i.choreCompact.setStatusPending(r);var e=i.defaultServerOptions(r);r.contribOPCUACompact={},r.contribOPCUACompact.initialized=!1,r.contribOPCUACompact.constructAddressSpaceScript=function(e,t,o){n.debugLog("Init Function Block Compact Server")},(t=i.initialize(r,e)).initialize(function(){i.postInitialize(r,t)}),i.run(r,t).then(function(){n.initialize(r,i,function(e,t){(e.contribOPCUACompact.vm=t).run("node.contribOPCUACompact.constructAddressSpaceScript = "+o.addressSpaceScript),e.contribOPCUACompact.initialized=!0,e.emit("server_node_running")}),i.choreCompact.setStatusActive(r)}).catch(function(e){r.warn(e),r.emit("server_node_error",e)})},r.delayToInit));function c(o){e&&clearTimeout(e),t?i.stop(r,t,function(){setTimeout(function(){i.choreCompact.setStatusClosed(r);var e=r,t=o;if(e.outstandingTimers){for(;0<e.outstandingTimers.length;)clearTimeout(e.outstandingTimers.pop());for(;0<e.outstandingIntervals.length;)clearInterval(e.outstandingIntervals.pop())}i.detailLog("closed node "+e.id),t()},r.delayToClose)}):o()}r.on("close",function(e){c(e)})}),a.library.register("opcua")};
//# sourceMappingURL=maps/server-node.js.map
